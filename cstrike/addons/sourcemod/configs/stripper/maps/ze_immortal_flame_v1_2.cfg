;laser dmg type change
modify:
{
    match:
    {
        "origin" "-7488 160 640"
        "classname" "trigger_hurt"
    }
    replace:
    {
        "damagetype" "16384"
    }
}

;
; Below changes by Koen (STEAM_0:1:114921174)
;

; Add trigger check
modify:
{
    match:
    {
        "targetname" "T"
    }
    insert:
    {
        "OnPass" "CMD,Command,say ~ Zombies have reached a trigger... ~,0,1"
        "OnPass" "fade3,Fade,,0,1"
        "OnPass" "player,SetHealth,-1,2,1"
    }
}
modify:
{
    match:
    {
        "hammerid" "/(12019|15013|17151|17185|41039|41064)/"
    }
    insert:
    {
        "OnPressed" "T,TestActivator,,0,1"
    }
}
modify:
{
    match:
    {
        "hammerid" "/(29769|41157|41175|41423)/"
    }
    insert:
    {
        "OnStartTouch" "T,TestActivator,,0,1"
    }
}

; Require both top/bottom triggers to advance
add:
{
    "classname" "math_counter"
    "targetname" "trigger_count"
    "max" "2"
    "min" "0"
    "startvalue" "0"
    "StartDisabled" "0"
    "OnHitMax" "CMD,Command,say ~ Both portals open in 20s ~,0,1"
    "OnHitMax" "CMD,Command,say ~ Both portals are now open ~,20,1"
    "OnHitMax" "tele5_2,Enable,,20,1"
    "OnHitMax" "tele5_1,Enable,,20,1"
}
modify:
{
    match:
    {
        "hammerid" "41157"
    }
    delete:
    {
        "OnStartTouch" "tele5_2,Enable,,20,1"
        "OnStartTouch" "CMD,Command,say ~ Upper portal open in 20s ~,0,1"
        "OnStartTouch" "CMD,Command,say ~ Upper portal is now open ~,20,1"
    }
    insert:
    {
        "OnStartTouch" "trigger_count,Add,1,0,1"
    }
}
modify:
{
    match:
    {
        "hammerid" "41175"
    }
    delete:
    {
        "OnStartTouch" "tele5_1,Enable,,20,1"
        "OnStartTouch" "CMD,Command,say ~ Bottom portal open in 20s ~,0,1"
        "OnStartTouch" "CMD,Command,say ~ Bottom portal is now open ~,20,1"
    }
    insert:
    {
        "OnStartTouch" "trigger_count,Add,1,0,1"
    }
}

; Fix multiple logic_auto
filter:
{
    "classname" "logic_auto"
}
add:
{
    "classname" "logic_auto"
    "spawnflags" "1"
    "OnMapSpawn" "b,Disable,,0,-1"
    "OnMapSpawn" "end_wall,Enable,,0,-1"
    "OnMapSpawn" "door_portal_end,Open,,0,-1"
    "OnMapSpawn" "CMD,Command,mp_roundtime 12,0,-1"
}

; Fix not adjustable music volume
modify:
{
    match:
    {
        "message" "immortal_flame.mp3"
    }
    replace:
    {
        "message" "#immortal_flame.mp3"
    }
}
modify:
{
    match:
    {
        "message" "lust_felt.mp3"
    }
    replace:
    {
        "message" "#lust_felt.mp3"
    }
}
modify:
{
    match:
    {
        "message" "arforest - antique.mp3"
    }
    replace:
    {
        "message" "#arforest - antique.mp3"
    }
}