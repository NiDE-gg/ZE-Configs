;----------------------------------------------------------
;Fix player gravity being set too low, leading to sv crash
;----------------------------------------------------------
modify:
{
	match:
	{
		"hammerid" "4007439"
		"classname" "logic_auto"
	}
	delete:
	{
		"OnNewGame" "cmd,Command,sm_gravity #STEAM_0_0_110396259 0.1,1.5,1"
		"OnNewGame" "cmd,Command,sm_gravity #STEAM_0_1_46778978 0.1,1.5,1"
		"OnNewGame" "cmd,Command,sm_gravity #STEAM_0_0_53776597 0.1,1.5,1"
		"OnNewGame" "cmd,Command,sm_gravity #STEAM_0_0_29769953 0.1,1.5,1"
		"OnNewGame" "cmd,Command,sm_gravity #STEAM_0_1_78079542 0.1,1.5,1"
		"OnNewGame" "cmd,Command,sm_gravity #STEAM_0_1_43083623 0.1,1.5,1"
		"OnNewGame" "cmd,Command,sm_gravity #STEAM_0_0_84308853 0.1,1.5,1"
		"OnNewGame" "cmd,Command,sm_gravity #STEAM_0_0_54446629 0.1,1.5,1"
		"OnNewGame" "cmd,Command,sm_gravity #STEAM_0_0_58001308 0.1,1.5,1"
		"OnNewGame" "cmd,Command,sm_gravity #STEAM_0_0_55437521 0.1,1.5,1"
		"OnNewGame" "cmd,Command,sm_gravity #STEAM_0_0_180242646 0.1,1.5,1"
		"OnNewGame" "cmd,Command,sm_gravity #STEAM_0_0_105253205 0.1,1.5,1"
	}
	insert:
	{
		"OnNewGame" "cmd,Command,sm_gravity #STEAM_0_0_110396259 0.3,1.5,1"
		"OnNewGame" "cmd,Command,sm_gravity #STEAM_0_1_46778978 0.3,1.5,1"
		"OnNewGame" "cmd,Command,sm_gravity #STEAM_0_0_53776597 0.3,1.5,1"
		"OnNewGame" "cmd,Command,sm_gravity #STEAM_0_0_29769953 0.3,1.5,1"
		"OnNewGame" "cmd,Command,sm_gravity #STEAM_0_1_78079542 0.3,1.5,1"
		"OnNewGame" "cmd,Command,sm_gravity #STEAM_0_1_43083623 0.3,1.5,1"
		"OnNewGame" "cmd,Command,sm_gravity #STEAM_0_0_84308853 0.3,1.5,1"
		"OnNewGame" "cmd,Command,sm_gravity #STEAM_0_0_54446629 0.3,1.5,1"
		"OnNewGame" "cmd,Command,sm_gravity #STEAM_0_0_58001308 0.3,1.5,1"
		"OnNewGame" "cmd,Command,sm_gravity #STEAM_0_0_55437521 0.3,1.5,1"
		"OnNewGame" "cmd,Command,sm_gravity #STEAM_0_0_180242646 0.3,1.5,1"
		"OnNewGame" "cmd,Command,sm_gravity #STEAM_0_0_105253205 0.3,1.5,1"
	}
}

;--------------------------------------------------------------------
;Add damage to windmill propeller to block safe spot during zm round
;--------------------------------------------------------------------
modify:
{
	match:
	{
		"classname" "func_rotating"
		"origin" "2186.96 -1721.24 419.45"
	}
	replace:
	{
		"dmg" "10"
	}
}

filter:
{
	"targetname" "Admin_Access_Button"
	"classname" "func_button"
	"hammerid" "5068986"
}

modify:
{
	match:
	{
		"targetname" "cmd"
		"origin" "8008 -520 264"
		"classname" "point_servercommand"
	}
	delete:
	{
		"OnUser1" "!self,Command,sv_enablebunnyhopping 0,0,1"
	}
}

modify:
{
	match:
	{
		"targetname" "Shinra_Gate_2C"
		"origin" "-12452 12189 2804"
		"classname" "func_movelinear"
	}
	insert:
	{
		"OnFullyOpen" "cmd,Command,sv_enablebunnyhopping 0,0,1"
	}
}

modify:
{
	match:
	{
		"hammerid" "4007439"
		"classname" "logic_auto"
	}
	insert:
	{
		"OnNewGame" "cmd,Command,sv_enablebunnyhopping 1,0,-1"
	}
}

;----------------------------------------------------------------------------
; Makes a trigger_teleport so people cannot glitch through wall displacement
;----------------------------------------------------------------------------
add:
{
	"model" "*80"
	"targetname" "displacement_fix_1"
	"target" "Admin_Room_Back_TD"
	"StartDisabled" "0"
	"spawnflags" "1"
	"origin" "2491.8 -756 192.24"
	"classname" "trigger_teleport"
}

;-----------------------------------------------
; Fixes unreachable spot on zm mode / all modes
;-----------------------------------------------
modify:
{
	match:
	{
		"classname" "func_rotating"
		"origin" "2186.96 -1721.24 419.45"
	}
	replace:
	{
		"spawnflags" "69"
	}
}

;--------------
; Anti-yektima
;--------------
;add:
;{
;	"origin" "8936 7784 180"
;	"UseRandomTime" "0"
;	"targetname" "blindness_prevention_timer"
;	"StartDisabled" "1"
;	"spawnflags" "0"
;	"RefireTime" "1"
;	"classname" "logic_timer"
;	"OnTimer" "Item_Ultima_Effect,Stop,,0,-1"
;	"OnTimer" "Map_Fade,Kill,,0,-1"
;}
;modify:
;{
;	match:
;	{
;		"classname" "trigger_push"
;		"origin" "-12544 7670 2804"
;		"targetname" "Genesis_HP_Push"
;	}
;	insert:
;	{
;		"OnStartTouch" "blindness_prevention_timer,Enable,,0,1"
;		"OnStartTouch" "cmd,Command,say *** Blindness prevention activated ***,0,1"
;	}
;}
;add:
;{
;	"model" "*76"
;	"targetname" "blindness_prevention_hard_and_extreme"
;	"StartDisabled" "0"
;	"spawnflags" "1"
;	"origin" "9128 7196 335.5"
;	"classname" "trigger_once"
;	"OnStartTouch" "blindness_prevention_timer,Enable,,0,1"
;	"OnStartTouch" "cmd,Command,say *** Blindness prevention activated ***,0,1"
;}

;---------------------------------------------------
;Fix zms being boosted out of teleports and into C4
;---------------------------------------------------
modify:
{
	match:
	{
		"targetname" "Map_TP_1"
		"classname" "trigger_teleport"
		"origin" "3024 -2564 1200"
	}
	insert:
	{
		"OnStartTouch" "!activator,AddOutput,absvelocity 0 0 0,0,-1"
	}
}

;--------------------------------
; Fix incorrect targetname usage
;--------------------------------
modify:
{
	match:
	{
		"targetname" "Map_Start_Reset"
		"classname" "trigger_multiple"
	}
	delete:
	{
		"OnStartTouch" "!activator,AddOutput,targetname player,0,-1"
	}
	insert:
	{
		"OnStartTouch" "!activator,AddOutput,targetname player_none,0,-1"
	}
}
modify:
{
	match:
	{
		"targetname" "Filter_Any"
		"classname" "filter_activator_name"
	}
	replace:
	{
		"filtername" "player_none"
	}
}

;-------------------
; Adjust level case
;-------------------
modify:
{
	match:
	{
		"origin" "8008 -776 265"
		"targetname" "Levels_Case"
		"classname" "logic_case"
		"hammerid" "2752503"
	}
	delete:
	{
		"OnCase01" "worldspawn,AddOutput,OnUser1 Levels_Counter:SetValue:2:0:1,45,-1"
		"OnCase01" "worldspawn,FireUser1,,29.95,-1"
	}
	insert:
	{
		"OnCase01" "worldspawn,AddOutput,OnUser1 Levels_Counter:SetValue:2:0:1,1,-1"
	}
}


;------------------------------------------------------
; Add beams to show a trigger's bounds in cave descent
;------------------------------------------------------
add:
{
	"origin" "-4720 -1401 1336"
	"TouchType" "0"
	"TextureScroll" "35"
	"texture" "sprites/laserbeam.spr"
	"targetname" "Gi_Cave_TP_beam1"
	"StrikeTime" "1"
	"spawnflags" "1"
	"renderfx" "0"
	"rendercolor" "0 192 0"
	"renderamt" "200"
	"Radius" "256"
	"NoiseAmplitude" "0"
	"LightningStart" "Gi_Cave_TP_beam1"
	"LightningEnd" "Gi_Cave_TP_beam2"
	"life" "0"
	"HDRColorScale" "1.0"
	"framestart" "0"
	"framerate" "0"
	"decalname" "Bigshot"
	"damage" "0"
	"BoltWidth" "2"
	"classname" "env_beam"
}
add:
{
	"origin" "-4720 -1057 1336"
	"TouchType" "0"
	"TextureScroll" "35"
	"texture" "sprites/laserbeam.spr"
	"targetname" "Gi_Cave_TP_beam2"
	"StrikeTime" "1"
	"spawnflags" "1"
	"renderfx" "0"
	"rendercolor" "0 192 0"
	"renderamt" "200"
	"Radius" "256"
	"NoiseAmplitude" "0"
	"LightningStart" "Gi_Cave_TP_beam2"
	"LightningEnd" "Gi_Cave_TP_beam3"
	"life" "0"
	"HDRColorScale" "1.0"
	"framestart" "0"
	"framerate" "0"
	"decalname" "Bigshot"
	"damage" "0"
	"BoltWidth" "2"
	"classname" "env_beam"
}
add:
{
	"origin" "-4786 -1057 1336"
	"TouchType" "0"
	"TextureScroll" "35"
	"texture" "sprites/laserbeam.spr"
	"targetname" "Gi_Cave_TP_beam3"
	"StrikeTime" "1"
	"spawnflags" "1"
	"renderfx" "0"
	"rendercolor" "0 192 0"
	"renderamt" "200"
	"Radius" "256"
	"NoiseAmplitude" "0"
	"LightningStart" "Gi_Cave_TP_beam3"
	"LightningEnd" "Gi_Cave_TP_beam4"
	"life" "0"
	"HDRColorScale" "1.0"
	"framestart" "0"
	"framerate" "0"
	"decalname" "Bigshot"
	"damage" "0"
	"BoltWidth" "2"
	"classname" "env_beam"
}
add:
{
	"origin" "-4786 -804 1336"
	"targetname" "Gi_Cave_TP_beam4"
	"spawnflags" "0"
	"angles" "0 0 0"
	"classname" "info_teleport_destination"
}

;------------------------------------------------
; Fix Boss unlocking Earth (Normal/Hard/Extreme)
; Prevent the earth from affecting the hitbox
;------------------------------------------------
modify:
{
	match:
	{
		"targetname" "Gi_Nattak_Attack_Case"
		"classname" "logic_case"
		"hammerid" "204836"
	}
	delete:
	{
		"OnCase09" "Item_Relay*,Enable,,15,1"
	}
	insert:
	{
		"OnCase09" "Item_Relay_Heal,Enable,,15,1"
		"OnCase09" "Item_Relay_Fire,Enable,,15,1"
		"OnCase09" "Item_Relay_Electro,Enable,,15,1"
		"OnCase09" "Item_Relay_Bio,Enable,,15,1"
		"OnCase09" "Item_Relay_Gravity,Enable,,15,1"
		"OnCase09" "Item_Relay_Wind,Enable,,15,1"
		"OnCase09" "Item_Relay_Ultima,Enable,,15,1"
		"OnCase09" "Item_Relay_Sleep,Enable,,15,1"
		"OnCase09" "Item_Relay_Potion,Enable,,15,1"
	}
}

;--------------------------------------
; Fix players early triggering airship
;--------------------------------------
modify:
{
	match:
	{
		"targetname" "Extreme_End_Relay"
		"classname" "logic_relay"
	}
	delete:
	{
		"OnTrigger" "End_Airship_Ex_Start,Enable,,0,-1"
		"OnTrigger" "End_Airship_Ex_Start,Disable,,19.95,-1"
	}
	insert:
	{
		"OnTrigger" "End_Airship_Ex_Start,Kill,,19.95,-1"
		"OnTrigger" "lvl2_Gi_Nattak_Counter,AddOutput,OnHitMin End_Airship_Ex_Start:Enable::0:1,0,1"
	}
}