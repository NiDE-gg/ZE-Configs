;-----------------------------------------------------
; fix dragon func_door not killing after boss on s4
;-----------------------------------------------------
modify:
{
    match:
    {
        "targetname" "stage4_boss_death2_relay"
        "classname" "logic_relay"
    }
    insert:
    {
		"OnTrigger" "stage4_boss_door,Kill,,0,1"
    }
}

;-----------------------------------------------------
; fix ending killing players with item targetname
;-----------------------------------------------------
modify:
{
    match:
    {
        "targetname" "stage4_boss_death2_relay"
        "classname" "logic_relay"
    }
    delete:
    {
        "OnTrigger" "human_heal_*,Kill,,0,1"
        "OnTrigger" "human_ice*,Kill,,0,1"
        "OnTrigger" "human_ice_stone*,Kill,,0,1"
        "OnTrigger" "human_fire*,Kill,,0,1"
    }
    insert:
    {
		"OnTrigger" "human_heal_button,Lock,,0,1"
		"OnTrigger" "human_ice_button,Lock,,0,1"
		"OnTrigger" "human_fire_button,Lock,,0,1"
		"OnTrigger" "human_stone_ice_button,Lock,,0,1"
    }
}

;-------------------------------------------------------------------------------------
; Adds a trigger_hurt at the ending platform to prevent players stepping on it
;-------------------------------------------------------------------------------------
add:
{
	"model" "*159"
	"targetname" "s4_platform_fix_hurt"
	"StartDisabled" "0"
	"spawnflags" "1"
	"origin" "-5952 -5504 -8984"
	"nodmgforce" "0"
	"filtername" "filter_human"
	"damagetype" "1024"
	"damagemodel" "0"
	"damagecap" "999999"
	"damage" "60"
	"classname" "trigger_hurt"
}
add:
{
	"model" "*159"
	"targetname" "s4_platform_fix_hurt"
	"StartDisabled" "0"
	"spawnflags" "1"
	"origin" "-5952 -4352 -8984"
	"nodmgforce" "0"
	"filtername" "filter_human"
	"damagetype" "1024"
	"damagemodel" "0"
	"damagecap" "999999"
	"damage" "60"
	"classname" "trigger_hurt"
}

;-------------------------------------------
; Fixes gravity on stage 3 begninning area
;-------------------------------------------
modify:
{
	match:
	{
		"origin" "-10688 12608 4896"
		"classname" "trigger_multiple"
	}
	delete:
	{
		"OnStartTouch" "!activator,AddOutput,gravity 0.09,0,-1"
		"OnEndTouch" "!activator,AddOutput,gravity 1,0.05,-1"
		"OnEndTouch" "!activator,AddOutput,gravity 1,0,-1"
	}
	insert:
	{
		"OnStartTouch" "!activator,AddOutput,gravity 0.09,0,-1"
		"OnUser1" "!self,Disable,,0.1,-1"
		"OnUser1" "!self,Enable,,0.2,-1"
		"OnUser1" "!self,FireUser1,,0.3,-1"
		"targetname" "gravity_enabler"
	}
}
modify:
{
	match:
	{
		"origin" "-6536 -2408 1144"
		"targetname" "level3_relay"
		"classname" "logic_relay"
	}
	insert:
	{
		"OnTrigger" "gravity_enabler,FireUser1,,15,1"
		"OnTrigger" "gravity_disabler,FireUser1,,15,1"
	}
}
modify:
{
	match:
	{
		"origin" "13040 13808 7240"
		"targetname" "s2_boss_death_relay"
		"classname" "logic_relay"
	}
	insert:
	{
		"OnTrigger" "gravity_enabler,FireUser1,,15,1"
		"OnTrigger" "gravity_disabler,FireUser1,,15,1"
	}
}
add:
{
	"model" "*122"
	"wait" "0.1"
	"targetname" "gravity_disabler"
	"StartDisabled" "0"
	"spawnflags" "1"
	"origin" "-10944 7520 7600"
	"classname" "trigger_multiple"
	"OnStartTouch" "!activator,AddOutput,gravity 1,0,-1"
	"OnUser1" "!self,Disable,,0.1,-1"
	"OnUser1" "!self,Enable,,0.2,-1"
	"OnUser1" "!self,FireUser1,,0.3,-1"
}
modify:
{
	match:
	{
		"targetname" "s3_button01"
		"origin" "-9944 8992.01 7136"
		"classname" "func_button"
	}
	insert:
	{
		"OnPressed" "player,addoutput,gravity 1,41,1"
	}
}
;-------------------------------------------
; Add zm push to start of s3
;-------------------------------------------
modify:
{
	match:
	{
		"origin" "-6536 -2408 1144"
		"targetname" "level3_relay"
		"classname" "logic_relay"
	}
	insert:
	{
		"OnTrigger" "cmd,Command,say ** ZM PUSH DISABLING IN 5 SECONDS **,20,1"
		"OnTrigger" "s3_start_zm_push,Kill,,25,1"
	}
}
modify:
{
	match:
	{
		"origin" "13040 13808 7240"
		"targetname" "s2_boss_death_relay"
		"classname" "logic_relay"
	}
	insert:
	{
		"OnTrigger" "cmd,Command,say ** ZM PUSH DISABLING IN 5 SECONDS **,20,1"
		"OnTrigger" "s3_start_zm_push,Kill,,25,1"
	}
}
add:
{
	"model" "*57"
	"targetname" "s3_start_zm_push"
	"StartDisabled" "0"
	"speed" "888"
	"spawnflags" "1"
	"pushdir" "0 0 0"
	"origin" "-8208 13760 3680"
	"filtername" "filter_zombie"
	"alternateticksfix" "0"
	"classname" "trigger_push"
}
;-------------------------------------------
; Fix long tp after s1 boss
;-------------------------------------------
add:
{
	"model" "*110"
	"targetname" "stage1_teleport01_afboss"
	"target" "stage2_dest"
	"StartDisabled" "1"
	"spawnflags" "1"
	"origin" "5488 5584 6192"
	"classname" "trigger_teleport"
}
modify:
{
	match:
	{
		"origin" "4640 5600 4168"
		"targetname" "yzx_dragon_death_relay"
		"classname" "logic_relay"
	}
	insert:
	{
		"OnTrigger" "cmd,Command,say ** ZM TP ENABLING IN 5 SECONDS **,12,1"
		"OnTrigger" "stage1_teleport01_afboss,Enable,,17,1"
		"OnTrigger" "s1_zm_cage_tp,Kill,,15,1"
	}
}
;-------------------------------------------
; Nerf human heal item
;-------------------------------------------
modify:
{
	match:
	{	
		"classname" "trigger_hurt"
		"targetname" "human_heal_trigger"
	}
	replace:
	{
		"damage" "-6"
	}
}
;-------------------------------------------
; Move s3 items positions
;-------------------------------------------
modify:
{
	match:
	{	
		"classname" "logic_relay"
		"targetname" "s3_human_item_location1"
	}
	replace:
	{
		"origin" "-7296 13248 2736"
	}
}
modify:
{
	match:
	{	
		"classname" "logic_relay"
		"targetname" "s3_human_item_location2"
	}
	replace:
	{
		"origin" "-8896 10944 5664"
	}
}
modify:
{
	match:
	{	
		"classname" "logic_relay"
		"targetname" "s3_human_item_location3"
	}
	replace:
	{
		"origin" "-7904 7296 6976"
	}
}
;---------------------------------------------------
; Fix human items particles in front of player vision
;---------------------------------------------------
modify:
{
	match:
	{	
		"classname" "info_particle_system"
		"targetname" "human_heal_eff"
	}
	replace:
	{
		"origin" "9460 12843 61"
	}
}
modify:
{
	match:
	{	
		"classname" "info_particle_system"
		"targetname" "human_ice_eff"
	}
	replace:
	{
		"origin" "9460 13547 61"
	}
}
modify:
{
	match:
	{	
		"classname" "info_particle_system"
		"targetname" "human_fire_eff"
	}
	replace:
	{
		"origin" "9460 14251 61"
	}
}
modify:
{
	match:
	{	
		"classname" "info_particle_system"
		"targetname" "human_stone_ice_eff"
	}
	replace:
	{
		"origin" "11028 13259 61"
	}
}
;---------------------------------------------
; Same for zm items
;---------------------------------------------
modify:
{
	match:
	{	
		"classname" "info_particle_system"
		"targetname" "zombie_heal_eff"
	}
	replace:
	{
		"origin" "10414 11856 65"
	}
}
modify:
{
	match:
	{	
		"classname" "info_particle_system"
		"targetname" "zombie_gravity_eff"
	}
	replace:
	{
		"origin" "10376 12588 65"
	}
}
modify:
{
	match:
	{	
		"classname" "info_particle_system"
		"targetname" "zombie_freezeball_eff"
	}
	replace:
	{
		"origin" "10895 12483 65"
	}
}
;---------------------------------------------
; Defense tweaks
;---------------------------------------------
modify:
{
	match:
	{
		"classname" "func_button"
		"targetname" "s1_button05"
	}
	delete:
	{
		"OnPressed" "s1_lift01,Open,,15,1"
		"OnPressed" "cmd,Command,say ** LIFT MOVING IN 15 SECONDS **,0,1"
	}
	insert:
	{
		"OnPressed" "s1_lift01,Open,,25,1"
		"OnPressed" "cmd,Command,say ** LIFT MOVING IN 25 SECONDS **,0,1"
	}
}
modify:
{
	match:
	{
		"classname" "func_button"
		"targetname" "s2_button03"
	}
	delete:
	{
		"OnPressed" "s2_lift01,Open,,15,1"
		"OnPressed" "cmd,Command,say ** LIFT MOVING IN 15 SECONDS **,0,1"
	}
	insert:
	{
		"OnPressed" "s2_lift01,Open,,25,1"
		"OnPressed" "cmd,Command,say ** LIFT MOVING IN 25 SECONDS **,0,1"
	}
}
modify:
{
	match:
	{
		"classname" "func_button"
		"targetname" "s2_button07"
	}
	delete:
	{
		"OnPressed" "s2_lift04,Open,,15,1"
		"OnPressed" "cmd,Command,say ** LIFT MOVING IN 15 SECONDS **,0,1"
	}
	insert:
	{
		"OnPressed" "s2_lift04,Open,,20,1"
		"OnPressed" "cmd,Command,say ** LIFT MOVING IN 20 SECONDS **,0,1"
	}
}
modify:
{
	match:
	{
		"classname" "func_button"
		"targetname" "s3_button02"
	}
	delete:
	{
		"OnPressed" "cmd,Command,say ** LIFT MOVING IN 20 SECONDS **,0,1"
		"OnPressed" "s3_lift01,Open,,20,1"
	}
	insert:
	{
		"OnPressed" "cmd,Command,say ** LIFT MOVING IN 25 SECONDS **,0,1"
		"OnPressed" "s3_lift01,Open,,25,1"
	}
}
modify:
{
	match:
	{
		"classname" "func_button"
		"targetname" "s3_button07"
	}
	delete:
	{
		"OnPressed" "cmd,Command,say ** LIFT MOVING IN 15 SECONDS **,0,1"
		"OnPressed" "s3_lift03,Open,,15,1"
	}
	insert:
	{
		"OnPressed" "cmd,Command,say ** LIFT MOVING IN 20 SECONDS **,0,1"
		"OnPressed" "s3_lift03,Open,,20,1"
	}
}
modify:
{
	match:
	{
		"classname" "trigger_once"
		"origin" "11712 -11568 2016"
	}
	delete:
	{
		"OnTrigger" "s4_door04,Open,,20,1"
		"OnTrigger" "cmd,Command,say ** DOOR OPENING IN 20 SECONDS **,0,1"
		"OnTrigger" "stage4_teleport04,Enable,,35,1"
		"OnTrigger" "s4_door04,Close,,33,1"
	}
	insert:
	{
		"OnTrigger" "s4_door04,Open,,25,1"
		"OnTrigger" "cmd,Command,say ** DOOR OPENING IN 25 SECONDS **,0,1"
		"OnTrigger" "stage4_teleport04,Enable,,40,1"
		"OnTrigger" "s4_door04,Close,,37,1"
	}
}
modify:
{
	match:
	{
		"classname" "func_button"
		"targetname" "s4_button03"
	}
	delete:
	{
		"OnPressed" "s4_lift01,Open,,25,1"
		"OnPressed" "cmd,Command,say ** LIFT MOVING IN 25 SECONDS **,0,1"
	}
	insert:
	{
		"OnPressed" "s4_lift01,Open,,20,1"
		"OnPressed" "cmd,Command,say ** LIFT MOVING IN 20 SECONDS **,0,1"
	}
}
modify:
{
	match:
	{
		"classname" "func_button"
		"targetname" "s4_button04"
	}
	delete:
	{
		"OnPressed" "s4_lift02,Open,,20,1"
		"OnPressed" "cmd,Command,say ** LIFT MOVING IN 20 SECONDS **,0,1"
	}
	insert:
	{
		"OnPressed" "s4_lift02,Open,,25,1"
		"OnPressed" "cmd,Command,say ** LIFT MOVING IN 25 SECONDS **,0,1"
	}
}
modify:
{
	match:
	{
		"classname" "func_button"
		"targetname" "s4_button07"
	}
	delete:
	{
		"OnPressed" "s4_lift03,Open,,20,1"
		"OnPressed" "cmd,Command,say ** LIFT MOVING IN 20 SECONDS **,0,1"
	}
	insert:
	{
		"OnPressed" "s4_lift03,Open,,25,1"
		"OnPressed" "cmd,Command,say ** LIFT MOVING IN 25 SECONDS **,0,1"
	}
}
;---------------------------------------------
; Reduce max health for boss and item
;---------------------------------------------
modify:
{
	match:
	{
		"classname" "trigger_multiple"
		"targetname" "xwz_human_addhp"
	}
	delete:
	{
		"OnStartTouch" "!activator,AddOutput,health 180,0,-1"
	}
	insert:
	{
		"OnStartTouch" "!activator,AddOutput,health 140,0,-1"
	}
}
modify:
{
	match:
	{
		"classname" "trigger_multiple"
		"targetname" "jzx_human_addhp"
	}
	delete:
	{
		"OnStartTouch" "!activator,AddOutput,health 180,0,-1"
	}
	insert:
	{
		"OnStartTouch" "!activator,AddOutput,health 140,0,-1"
	}
}
modify:
{
	match:
	{
		"classname" "trigger_multiple"
		"targetname" "human_heal_trigger"
	}
	delete:
	{
		"OnStartTouch" "!activator,AddOutput,max_health 180,0,-1"
	}
	insert:
	{
		"OnStartTouch" "!activator,AddOutput,max_health 140,0,-1"
	}
}