; Stripper is loaded
modify:
{
	match:
	{
		"classname" "logic_auto"
		"hammerid" "95093"
	}
	insert:
	{
		"OnMapSpawn" "cmd,Command,say **Stripper v1.1 loaded**,1,-1"
	}
}

; Nerf spear item
modify:
{
	match:
	{
		"targetname" "item_spear_filter"
		"classname" "filter_activator_name"
	}
	delete:
	{
		"OnPass" "item_spear_pushDisable0.8-1"
		"OnPass" "item_spear_moveClose0.8-1"
		"OnPass" "item_spear_buttonUnlock3-1"
	}
	insert:
	{
		"OnPass" "item_spear_pushDisable0.6-1"
		"OnPass" "item_spear_moveClose0.6-1"
		"OnPass" "item_spear_buttonUnlock4.5-1"
	}
}

; Modify SetFarZ to fix visual issue on gundyr boss area
modify:
{
	match:
	{
		"targetname" "t_s1_once_door_05"
		"classname" "trigger_once"
	}
	delete:
	{
		"OnStartTouch" "fogSetFarZ4000251"
	}
	insert:
	{
		"OnStartTouch" "fogSetFarZ5500251"
	}
}

; Disable gundyr hurt on start so it doesnt play any animation
modify:
{
	match:
	{
		"targetname" "gundyr_Hurt"
		"classname" "trigger_hurt"
	}
	delete:
	{
		"StartDisabled" "0"
	}
	insert:
	{
		"StartDisabled" "1"
	}
}

; Rework gundyr attacks and damage
modify:
{
	match:
	{
		"targetname" "gundyr_att_z1"
		"classname" "logic_relay"
	}
	insert:
	{
		"OnTrigger" "gundyr_maker_npcForceSpawn2-1"
		"OnTrigger" "gundyr_maker_npcForceSpawn3-1"
	}
}
modify:
{
	match:
	{
		"targetname" "gundyr_att_z1"
		"classname" "logic_relay"
	}
	insert:
	{
		"OnTrigger" "gundyr_maker_npcForceSpawn2-1"
		"OnTrigger" "gundyr_maker_npcForceSpawn3-1"
	}
}
modify:
{
	match:
	{
		"targetname" "wxc_gundyr_smoke_hurt"
		"classname" "trigger_hurt"
	}
	delete:
	{
		"damage" "150"
	}
	insert:
	{
		"damage" "300"
	}
}

; Modify lake of blood exit grate breaking time. Hold is longer
modify:
{
	match:
	{
		"targetname" "s2_grate_break_once"
		"classname" "trigger_once"
	}
	delete:
	{
		"OnStartTouch" "s2_grate_breakBreak151"
		"OnStartTouch" "cmdCommandsay ** KEEP DEFENDING ! **01"
		"OnStartTouch" "s2_teleport_07Enable341"
	}
	insert:
	{
		"OnStartTouch" "s2_grate_breakBreak251"
		"OnStartTouch" "cmdCommandsay ** KEEP DEFENDING ! **01"
		"OnStartTouch" "cmdCommandsay ** GRATE BREAKING IN 10 SECONDS **151"
		"OnStartTouch" "s2_teleport_07Enable351"
	}
}

; Keep enable the particle around eidolon on phase 2 to show players to not get near him since there is a trigger_hurt around the boss
modify:
{
	match:
	{
		"targetname" "boss_phase2_start_relay"
		"classname" "logic_relay"
	}
	delete:
	{
		"OnTrigger" "s1_sk_phase1_start_pKill4.51"
	}
}
modify:
{
	match:
	{
		"targetname" "phase2_sk_death_relay"
		"classname" "logic_relay"
	}
	delete:
	{
		"OnTrigger" "s1_sk_phase1_start_pKill01"
	}
}

; Lake of blood doors will disappear after some time to prevent infinite hold (2 min 10sec after door opens)
modify:
{
	match:
	{
		"targetname" "s2_button06"
		"classname" "func_button"
	}
	insert:
	{
		"OnPressed" "cmdCommandsay ** LAKE OF BLOOD ENTRANCE DOOR WILL BREAK IN 30 SECONDS **1001"
		"OnPressed" "cmdCommandsay ** LAKE OF BLOOD ENTRANCE DOOR WILL BREAK IN 10 SECONDS **1201"
		"OnPressed" "s2_lob_doors_pStart129.91"
		"OnPressed" "s2_lob_doors_p_sPlaySound129.91"
		"OnPressed" "s2_lake_of_blood_door1Kill1301"
		"OnPressed" "s2_lake_of_blood_door2Kill1301"
		"OnPressed" "s2_lob_doors_exp_npcTrigger1301"
		"OnPressed" "s2_lob_doors_exp_npc2Trigger1311"
		"OnPressed" "s2_lob_doors_exp_npc3Trigger1321"
	}
}

; Add the particles that will explose to break doors on lake of blood entrance
add:
{
	"classname" "info_particle_system"
	"targetname" "s2_lob_doors_p"
	"effect_name" "custom_particle_100"
	"start_active" "0"
	"angles" "0 0 0"
	"origin" "11708 -6268 -10892"
}
add:
{
	"classname" "info_particle_system"
	"targetname" "s2_lob_doors_p"
	"effect_name" "custom_particle_100"
	"start_active" "0"
	"angles" "0 0 0"
	"origin" "11932 -6324 -10780"
}

; Add the sound that will be played once door is kill with explosion
add:
{
	"targetname" "s2_lob_doors_p_s"
	"classname" "ambient_generic"
	"spawnflags" "48"
	"message" "explode_8"
	"health" "10"
	"radius" "6000"
	"pitchstart" "100"
	"pitch" "100"
	"origin" "11708 -6268 -10892"
}

; Add a mass of souls npcs once the lake of blood door break that will spawn instantly behind the door with zombies
add:
{
	"classname" "logic_relay"
	"targetname" "s2_lob_doors_exp_npc"
	"spawnflags" "0"
	"angles" "0 90 0"
	"origin" "11760 -6664 -10757.5"
	"OnTrigger" "maker_massofsoulsForceSpawnAtEntityOrigin!caller01"
	"OnTrigger" "!selfKill41"
}
add:
{
	"classname" "logic_relay"
	"targetname" "s2_lob_doors_exp_npc2"
	"spawnflags" "0"
	"angles" "0 90 0"
	"origin" "11968 -6624 -10757.5"
	"OnTrigger" "maker_massofsoulsForceSpawnAtEntityOrigin!caller01"
	"OnTrigger" "!selfKill41"
}
add:
{
	"classname" "logic_relay"
	"targetname" "s2_lob_doors_exp_npc3"
	"spawnflags" "0"
	"angles" "0 90 0"
	"origin" "11840 -6552 -10837.5"
	"OnTrigger" "maker_massofsoulsForceSpawnAtEntityOrigin!caller01"
	"OnTrigger" "!selfKill41"
}

; Add a particle to show that a npc spawned on stage 2 boss fight vermisanguis
add:
{
	"classname" "info_particle_system"
	"targetname" "oyt_Vermisanguis_npc_spawner_p2"
	"effect_name" "custom_particle_510"
	"start_active" "0"
	"angles" "0 0 0"
	"origin" "11052 4720 -14088"
}

; Add this particle to the existing template
modify:
{
	match:
	{
		"classname" "point_template"
		"targetname" "template_oyt_Vermisanguis_npc_spawner"
	}
	insert:
	{
		"Template04" "oyt_Vermisanguis_npc_spawner_p2"
	}
}

; The relay will start the particle when the npc spawn to prevent players
modify:
{
	match:
	{
		"classname" "logic_relay"
		"targetname" "oyt_Vermisanguis_npc_spawner_relay"
	}
	insert:
	{
		"OnSpawn" "oyt_Vermisanguis_npc_spawner_p2Start01"
		"OnSpawn" "oyt_Vermisanguis_npc_spawner_p2Kill11"
	}
}

; Modify trueend first music to fix issue stopping randomly in the middle
modify:
{
	match:
	{
		"targetname" "t_s2_music01"
		"classname" "ambient_generic"
	}
	delete:
	{
		"message" "#m4dara/music/for the dark soul.mp3"
	}
	insert:
	{
		"message" "#m4dara/music/darkeater midir.mp3"
	}
}

; On secret ending stage 1, the shortcut grate for zombies will also break after certain time and not only after triggering the lever
modify:
{
	match:
	{
		"targetname" "t_s1_button03"
		"classname" "func_button"
	}
	delete:
	{
		"OnPressed" "t_s1_break_door_2Break31"
	}
	insert:
	{
		"OnPressed" "t_s1_break_door_2Break1.51"
	}
}
modify:
{
	match:
	{
		"targetname" "t_s1_case_door"
		"classname" "logic_case"
	}
	insert:
	{
		"OnCase01" "t_s1_break_door_2Break651"
		"OnCase02" "t_s1_break_door_2Break651"
	}
}

; Add a trigger_hurt when barrel item explode that deal heavy damage to zombies
add:
{
	"model" "*64"
	"classname" "trigger_hurt"
	"targetname" "b_barrel_hurt_exp"
	"filtername" "filter_zombies"
	"StartDisabled" "1"
	"spawnflags" "9"
	"damagecap" "100"
	"damage" "3000"
	"origin" "2617.82 -8489.9 -5530"
}
modify:
{
	match:
	{
		"classname" "point_template"
		"targetname" "ab_barrel_template"
	}
	insert:
	{
		"Template10" "b_barrel_hurt_exp"
	}
}
modify:
{
	match:
	{
		"classname" "math_counter"
		"targetname" "b_barrel_counter"
	}
	insert:
	{
		"OnHitMax" "b_barrel_hurt_expEnable21"
		"OnHitMax" "b_barrel_hurt_expKill2.121"
	}
}
modify:
{
	match:
	{
		"classname" "logic_relay"
		"targetname" "b_barrel_relay"
	}
	insert:
	{
		"OnSpawn" "b_barrel_hurt_expKill301"
	}
}

; Modify damage of the toxic orb (zombie item)
modify:
{
	match:
	{
		"targetname" "zombie_poisonmagic_hurt1"
		"classname" "trigger_hurt"
	}
	delete:
	{
		"damage" "1"
		"damagetype" "16"
	}
	insert:
	{
		"damage" "200"
		"damagetype" "0"
	}
}

; Modify SetFarZ on secret ending stage 2 to fix visual glitch
modify:
{
	match:
	{
		"targetname" "s2_relay_fog_blood"
		"classname" "logic_relay"
	}
	delete:
	{
		"OnTrigger" "fogSetFarZ83000.41"
	}
	insert:
	{
		"OnTrigger" "fogSetFarZ94000.41"
	}
}
modify:
{
	match:
	{
		"targetname" "admin_stage2_trueending_relay"
		"classname" "logic_relay"
	}
	delete:
	{
		"OnTrigger" "fogSetFarZ850061"
	}
	insert:
	{
		"OnTrigger" "fogSetFarZ940061"
	}
}

; Modify both dragons "meteor" counter
modify:
{
	match:
	{
		"targetname" "o_x_dragon_sdm_counter"
		"classname" "math_counter"
	}
	delete:
	{
		"max" "16"
	}
	insert:
	{
		"max" "8"
	}
}
modify:
{
	match:
	{
		"targetname" "x_bone_dragon_sdm_counter"
		"classname" "math_counter"
	}
	delete:
	{
		"max" "20"
	}
	insert:
	{
		"max" "10"
	}
}

; Delete useless "playsound"
modify:
{
	match:
	{
		"targetname" "level2_relay"
		"classname" "logic_relay"
	}
	delete:
	{
		"OnTrigger" "s2_music02PlaySound3321"
	}
}

; Add trigger that kill humans if zombies reach levers
; Add the zm reach the objective trigger system through filter_activator_team
modify:
{
	match:
	{
		"classname" "filter_activator_team"
		"hammerid" "2421113"
	}
	insert:
	{
		"OnPass" "global_zm_detected_fadeFade0-1"
		"OnPass" "cmdCommandsay ** ZOMBIES HAVE REACHED THE OBJECTIVE **01"
		"OnPass" "playerSetHealth02.5-1"
	}
}

; Stage 1
; Add the trigger_once that will be use. If zombies touch this trigger before a human trigger the lever, round end
add:
{
	"model" "*316"
	"classname" "trigger_once"
	"targetname" "s1_zm_objective_1"
	"filtername" "filter_zombies"
	"StartDisabled" "0"
	"spawnflags" "1"
	"origin" "-1080 -7568 -304.01"
	"OnStartTouch" "filter_zombiesTestActivator01"
}

; Add on the button, if the human trigger the lever, the trigger_once is killed
modify:
{
	match:
	{
		"classname" "func_button"
		"hammerid" "2026068"
	}
	insert:
	{
		"OnPressed" "s1_zm_objective_1Kill01"
	}
}
add:
{
	"model" "*316"
	"classname" "trigger_once"
	"targetname" "s1_zm_objective_2"
	"filtername" "filter_zombies"
	"StartDisabled" "0"
	"spawnflags" "1"
	"origin" "160 -5600 -112.01"
	"OnStartTouch" "filter_zombiesTestActivator01"
}
modify:
{
	match:
	{
		"classname" "func_button"
		"hammerid" "2940625"
	}
	insert:
	{
		"OnPressed" "s1_zm_objective_2Kill01"
	}
}
add:
{
	"model" "*316"
	"classname" "trigger_once"
	"targetname" "s1_zm_objective_3"
	"filtername" "filter_zombies"
	"StartDisabled" "0"
	"spawnflags" "1"
	"origin" "-2944 -7008 -160.01"
	"OnStartTouch" "filter_zombiesTestActivator01"
}
modify:
{
	match:
	{
		"classname" "func_button"
		"hammerid" "2044761"
	}
	insert:
	{
		"OnPressed" "s1_zm_objective_3Kill01"
	}
}
add:
{
	"model" "*316"
	"classname" "trigger_once"
	"targetname" "s1_zm_objective_4"
	"filtername" "filter_zombies"
	"StartDisabled" "0"
	"spawnflags" "1"
	"origin" "2192 -7216 -192.01"
	"OnStartTouch" "filter_zombiesTestActivator01"
}
modify:
{
	match:
	{
		"classname" "func_button"
		"hammerid" "2185130"
	}
	insert:
	{
		"OnPressed" "s1_zm_objective_4Kill01"
	}
}

; Secret ending stage 1
add:
{
	"model" "*316"
	"classname" "trigger_once"
	"targetname" "t_s1_zm_objective_1"
	"filtername" "filter_zombies"
	"StartDisabled" "0"
	"spawnflags" "1"
	"origin" "6128 -1904 -1304.26"
	"OnStartTouch" "filter_zombiesTestActivator01"
}
modify:
{
	match:
	{
		"classname" "func_button"
		"hammerid" "3538823"
	}
	insert:
	{
		"OnPressed" "t_s1_zm_objective_1Kill01"
	}
}

; Stage 2
add:
{
	"model" "*316"
	"classname" "trigger_once"
	"targetname" "s2_zm_objective_1"
	"filtername" "filter_zombies"
	"StartDisabled" "0"
	"spawnflags" "1"
	"origin" "14416 -9000 -11760"
	"OnStartTouch" "filter_zombiesTestActivator01"
}
modify:
{
	match:
	{
		"classname" "func_button"
		"hammerid" "3035035"
	}
	insert:
	{
		"OnPressed" "s2_zm_objective_1Kill01"
	}
}
add:
{
	"model" "*316"
	"classname" "trigger_once"
	"targetname" "s2_zm_objective_2"
	"filtername" "filter_zombies"
	"StartDisabled" "0"
	"spawnflags" "1"
	"origin" "14456 -11408 -11760"
	"OnStartTouch" "filter_zombiesTestActivator01"
}
modify:
{
	match:
	{
		"classname" "func_button"
		"hammerid" "3035067"
	}
	insert:
	{
		"OnPressed" "s2_zm_objective_2Kill01"
	}
}
add:
{
	"model" "*316"
	"classname" "trigger_once"
	"targetname" "s2_zm_objective_3"
	"filtername" "filter_zombies"
	"StartDisabled" "0"
	"spawnflags" "1"
	"origin" "10688 -10784 -11280"
	"OnStartTouch" "filter_zombiesTestActivator01"
}
modify:
{
	match:
	{
		"classname" "func_button"
		"hammerid" "3314966"
	}
	insert:
	{
		"OnPressed" "s2_zm_objective_3Kill01"
	}
}
add:
{
	"model" "*316"
	"classname" "trigger_once"
	"targetname" "s2_zm_objective_4"
	"filtername" "filter_zombies"
	"StartDisabled" "0"
	"spawnflags" "1"
	"origin" "9312 -10232 -10704"
	"OnStartTouch" "filter_zombiesTestActivator01"
}
modify:
{
	match:
	{
		"classname" "func_button"
		"hammerid" "3035089"
	}
	insert:
	{
		"OnPressed" "s2_zm_objective_4Kill01"
	}
}
add:
{
	"model" "*316"
	"classname" "trigger_once"
	"targetname" "s2_zm_objective_5"
	"filtername" "filter_zombies"
	"StartDisabled" "0"
	"spawnflags" "1"
	"origin" "12168 -7744 -10384"
	"OnStartTouch" "filter_zombiesTestActivator01"
}
modify:
{
	match:
	{
		"classname" "func_button"
		"hammerid" "3035342"
	}
	insert:
	{
		"OnPressed" "s2_zm_objective_5Kill01"
	}
}
add:
{
	"model" "*316"
	"classname" "trigger_once"
	"targetname" "t_s2_zm_objective_0"
	"filtername" "filter_zombies"
	"StartDisabled" "0"
	"spawnflags" "1"
	"origin" "-13472 -3688 -8592"
	"OnStartTouch" "filter_zombiesTestActivator01"
}
modify:
{
	match:
	{
		"classname" "func_button"
		"hammerid" "4180886"
	}
	insert:
	{
		"OnPressed" "t_s2_zm_objective_0Kill01"
	}
}

; Secret ending stage 2
add:
{
	"model" "*316"
	"classname" "trigger_once"
	"targetname" "t_s2_zm_objective_1"
	"filtername" "filter_zombies"
	"StartDisabled" "0"
	"spawnflags" "1"
	"origin" "-13320 3992 -9609.57"
	"OnStartTouch" "filter_zombiesTestActivator01"
}
modify:
{
	match:
	{
		"classname" "func_button"
		"hammerid" "4193837"
	}
	insert:
	{
		"OnPressed" "t_s2_zm_objective_1Kill01"
	}
}
add:
{
	"model" "*316"
	"classname" "trigger_once"
	"targetname" "t_s2_zm_objective_2"
	"filtername" "filter_zombies"
	"StartDisabled" "0"
	"spawnflags" "1"
	"origin" "-10488 6176 -9488"
	"OnStartTouch" "filter_zombiesTestActivator01"
}
modify:
{
	match:
	{
		"classname" "func_button"
		"hammerid" "4191300"
	}
	insert:
	{
		"OnPressed" "t_s2_zm_objective_2Kill01"
	}
}

; Boost music volume and other sounds
add:
{
	"targetname" "s2_music02"
	"classname" "ambient_generic"
	"spawnflags" "49"
	"message" "#m4dara/music/demon_s souls [remake] ost - penetrator.mp3"
	"health" "10"
	"radius" "10000"
	"pitchstart" "100"
	"pitch" "100"
}
add:
{
	"targetname" "t_s2_saintarea"
	"classname" "ambient_generic"
	"spawnflags" "49"
	"message" "#m4dara/saintarea.mp3"
	"health" "10"
	"radius" "10000"
	"pitchstart" "100"
	"pitch" "100"
}
add:
{
	"targetname" "new_area_sound"
	"classname" "ambient_generic"
	"spawnflags" "49"
	"message" "m4dara/elden ring_new location.mp3"
	"health" "10"
	"radius" "10000"
	"pitchstart" "100"
	"pitch" "100"
}
add:
{
	"targetname" "enemy_felled_s"
	"classname" "ambient_generic"
	"spawnflags" "49"
	"message" "m4dara/elden ring  enemy felled.mp3"
	"health" "10"
	"radius" "10000"
	"pitchstart" "100"
	"pitch" "100"
}