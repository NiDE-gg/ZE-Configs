;Helicopter not controllable anymore by players (stages 1 & 2 ending)

modify:
{
	match:
	{
		"classname" "func_tracktrain"
		"targetname" "hydra_track"
	}
	replace:
	{
		"spawnflags" "515"
	}
}

;Disable all shadows. Fix crash maybe

modify:
{
	match:
	{
		"classname" "func_door"
	}
	replace:
	{
		"disablereceiveshadows" "1"
		"disableshadows" "1"
	}
}
modify:
{
	match:
	{
		"classname" "func_button"
	}
	replace:
	{
		"disablereceiveshadows" "1"
		"disableshadows" "1"
	}
}
modify:
{
	match:
	{
		"classname" "func_breakable"
	}
	replace:
	{
		"disablereceiveshadows" "1"
		"disableshadows" "1"
	}
}
modify:
{
	match:
	{
		"classname" "func_brush"
	}
	replace:
	{
		"disablereceiveshadows" "1"
		"disableshadows" "1"
	}
}
modify:
{
	match:
	{
		"classname" "func_tracktrain"
	}
	replace:
	{
		"disablereceiveshadows" "1"
		"disableshadows" "1"
	}
}
modify:
{
	match:
	{
		"classname" "func_illusionary"
	}
	replace:
	{
		"disablereceiveshadows" "1"
		"disableshadows" "1"
	}
}
modify:
{
	match:
	{
		"classname" "func_physbox_multiplayer"
	}
	replace:
	{
		"disablereceiveshadows" "1"
		"disableshadows" "1"
	}
}
modify:
{
	match:
	{
		"classname" "func_wall_toggle"
	}
	replace:
	{
		"disablereceiveshadows" "1"
		"disableshadows" "1"
	}
}
modify:
{
	match:
	{
		"classname" "func_tanktrain"
	}
	replace:
	{
		"disablereceiveshadows" "1"
		"disableshadows" "1"
	}
}
modify:
{
	match:
	{
		"classname" "func_rotating"
	}
	replace:
	{
		"disablereceiveshadows" "1"
		"disableshadows" "1"
	}
}
modify:
{
	match:
	{
		"classname" "func_movelinear"
	}
	replace:
	{
		"disablereceiveshadows" "1"
		"disableshadows" "1"
	}
}
modify:
{
	match:
	{
		"classname" "func_physbox"
	}
	replace:
	{
		"disablereceiveshadows" "1"
		"disableshadows" "1"
	}
}

;; _

;; stage 3 - fix afk teleport glitch spot

add:
{
	"targetname" "tele_explosion"
	"target" "tele_agua"
	"StartDisabled" "1"
	"spawnflags" "1"
	"origin" "7784.5 -3520.5 932.5"
	"classname" "trigger_teleport"
	"OnUser1" "!self,AddOutput,solid 2,0,1"
	"OnUser1" "!self,AddOutput,mins -387.5 -980.5 -211.5,0.1,1"
	"OnUser1" "!self,AddOutput,maxs 387.5 980.5 211.5,0.1,1"
}
modify:
{
	match:
	{
		"classname" "logic_auto"
		"hammerid" "4561"
	}
	insert:
	{
		"OnMapSpawn" "tele_explosion,FireUser1,,0,-1"
	}
}

;; stage 3 - ending balance

modify:
{
	match:
	{
		"targetname" "tele_explosion"
		"classname" "trigger_teleport"
	}
	replace:
	{
		"target" "tele_agua"
	}
}
modify:
{
	match:
	{
		"targetname" "boton_ascensor_extremo"
		"classname" "func_button"
	}
	insert:
	{
		"OnPressed" "tele_ascensor_tri_2,ClearParent,,13,1"
	}
}
modify:
{
	match:
	{
		"targetname" "ascensorfinal_3"
		"classname" "path_track"
	}
	delete:
	{
		"OnPass" "tele_ascensor_tri_2,ClearParent,,0,-1"
	}
}
modify:
{
	match:
	{
		"targetname" "ascensorfinal_4"
		"classname" "path_track"
	}
	delete:
	{
		"OnPass" "tele_ascensor_tri_2,Kill,,14,-1"
	}
}

;; stage 3 - fix hoverboat pathing

filter:
{
	"targetname" "/hover_((12)|(14)|(32)|(34)|(33)|(21)|(25)|(16)|(24)|(26)|(30))/"
	"classname" "path_track"
}

modify:
{
	match:
	{
		"targetname" "hover_20"
		"classname" "path_track"
	}
	replace:
	{
		"origin" "9718 524 -2646"
		"target" "hover_15"
	}
}
modify:
{
	match:
	{
		"targetname" "hover_15"
		"classname" "path_track"
	}
	replace:
	{
		"origin" "9387 211 -2642"
		"target" "hover_22"
	}
}
modify:
{
	match:
	{
		"targetname" "hover_22"
		"classname" "path_track"
	}
	replace:
	{
		"origin" "9656 -209 -2642"
	}
}

;; stage 3 - increase boss hp

modify:
{
	match:
	{
		"targetname" "trigger_boss_activar"
		"classname" "trigger_multiple"
	}
	delete:
	{
		"OnStartTouch" "vidajefe,Add,80,0,-1"
	}
	insert:
	{
		"OnStartTouch" "vidajefe,Add,100,0,-1"
	}
}

;
; Below changes by Koen (STEAM_0:1:114921174)
;

; Replace existing physics level system with permanent entities
add:
{
	"classname" "info_target"
	"targetname" "Stage_CounterInit"
	"spawnflags" "0"
	"OnUser1" "Stage_CounterTemplate,ForceSpawn,,0,1"
	"OnUser1" "Stage_Counter,AddOutput,classname info_target,0.03,1"
	"OnUser1" "!self,Kill,,0.06,1"
}
add:
{
	"classname" "point_template"
	"targetname" "Stage_CounterTemplate"
	"Template01" "Stage_Counter"
	"spawnflags" "2"
}
add:
{
	"classname" "math_counter"
	"targetname" "Stage_Counter"
	"startvalue" "1"
	"StartDisabled" "0"
	"min" "1"
	"max" "5"
	"OnGetValue" "Stage_Case,InValue,,0,-1"
}
add:
{
	"classname" "logic_case"
	"targetname" "Stage_Case"
	"Case01" "1"
	"Case02" "2"
	"Case03" "3"
	"OnCase01" "Stage_Normal_Relay,Trigger,,0,1"
	"OnCase02" "Stage_Hard_Relay,Trigger,,0,1"
	"OnCase03" "Stage_Extreme_Relay,Trigger,,0,1"
}
modify:
{
	match:
	{
		"classname" "logic_auto"
	}
	insert:
	{
		"OnMapSpawn" "Stage_CounterInit,FireUser1,,0,1"
		"OnMapSpawn" "Stage_Counter,GetValue,,0.03,1"
	}
}

; Change existing stage change triggers to the new system
modify:
{
	match:
	{
		"targetname" "normalboton"
	}
	delete:
	{
		"OnPressed" "normal,Disable,,0,-1"
		"OnPressed" "dificil,Enable,,0,-1"
		"OnPressed" "extremo,Enable,,0,-1"
	}
	insert:
	{
		"OnPressed" "Stage_Counter,SetValueNoFire,1,0,-1"
	}
}
modify:
{
	match:
	{
		"targetname" "dificilboton"
	}
	delete:
	{
		"OnPressed" "extremo,Enable,,0,-1"
		"OnPressed" "dificil,Disable,,0,-1"
		"OnPressed" "normal,Enable,,0,-1"
	}
	insert:
	{
		"OnPressed" "Stage_Counter,SetValueNoFire,2,0,-1"
	}
}
modify:
{
	match:
	{
		"targetname" "extremoboton"
	}
	delete:
	{
		"OnPressed" "extremo,Disable,,0,-1"
		"OnPressed" "dificil,Enable,,0,-1"
		"OnPressed" "normal,Enable,,0,-1"
	}
	insert:
	{
		"OnPressed" "Stage_Counter,SetValueNoFire,3,0,-1"
	}
}
modify:
{
	match:
	{
		"targetname" "ganarfacil"
	}
	delete:
	{
		"OnStartTouch" "dificil,Disable,,0,-1"
		"OnStartTouch" "normal,Enable,,0,-1"
		"OnStartTouch" "extremo,Enable,,0,-1"
	}
	insert:
	{
		"OnStartTouch" "Stage_Counter,SetValueNoFire,2,0,1"
	}
}
modify:
{
	match:
	{
		"targetname" "ganarnormal"
	}
	delete:
	{
		"OnStartTouch" "dificil,Enable,,0,-1"
		"OnStartTouch" "normal,Enable,,0,-1"
		"OnStartTouch" "extremo,Disable,,0,-1"
	}
	insert:
	{
		"OnStartTouch" "Stage_Counter,SetValueNoFire,3,0,1"
	}
}
modify:
{
	match:
	{
		"targetname" "ganarextremo"
	}
	delete:
	{
		"OnStartTouch" "dificil,Enable,,0,-1"
		"OnStartTouch" "normal,Disable,,0,-1"
		"OnStartTouch" "extremo,Enable,,0,-1"
	}
	insert:
	{
		"OnStartTouch" "Stage_Counter,SetValueNoFire,1,0,1"
	}
}

; Convert stage triggers to relays
add:
{
	"classname" "logic_relay"
	"targetname" "Stage_Normal_Relay"
	"spawnflags" "0"
	"OnTrigger" "nhbarrica1,Kill,,0,-1"
	"OnTrigger" "hardbarricada1,Kill,,0,-1"
	"OnTrigger" "d13,Lock,,0,-1"
	"OnTrigger" "d14,Lock,,0,-1"
	"OnTrigger" "extremebarricada2,Kill,,0,-1"
	"OnTrigger" "hardbarricada3,Kill,,0,-1"
	"OnTrigger" "commander,Command,say ** ORIGINAL MAP BY SOLDIERBEST **,3,-1"
	"OnTrigger" "commander,Command,say ** MAPPING BY KAGALERA **,4,-1"
	"OnTrigger" "commander,Command,say ** THANKS FOR PLAYING **,6,-1"
	"OnTrigger" "commander,Command,say ** LEVEL: NORMAL **,2,-1"
	"OnTrigger" "boton3,Lock,,0,-1"
	"OnTrigger" "Triggermusica1,Enable,,0,-1"
	"OnTrigger" "normalbarricada2,Kill,,0,-1"
	"OnTrigger" "dificilbotonascensores,Kill,,0,-1"
	"OnTrigger" "finalnormal,Enable,,0,-1"
	"OnTrigger" "finaldificil,Disable,,0,-1"
	"OnTrigger" "relay_ascensor_hard,Kill,,0,-1"
	"OnTrigger" "relay_ascensor_extremo,Kill,,0,-1"
	"OnTrigger" "killextremo,Kill,,0,-1"
	"OnTrigger" "killhard,Kill,,0,-1"
	"OnTrigger" "normalbarricada3,Kill,,0,-1"
	"OnTrigger" "normalbarricada4,Kill,,0,-1"
	"OnTrigger" "ganarnormal,Kill,,0,-1"
	"OnTrigger" "boton_hard1,Kill,,0,-1"
	"OnTrigger" "shake_general,StopShake,,0.5,-1"
	"OnTrigger" "commander,Command,say ** MODELS IDEAS SOME HELP AND ORIGINALITY BY K.**,5,-1"
	"OnTrigger" "torreta_random,PickRandomShuffle,,0,1"
	"OnTrigger" "fuego_normal_de,Disable,,0,-1"
	"OnTrigger" "lanza_luz,TurnOff,,0,-1"
	"OnTrigger" "normaltrigger1,Enable,,0,-1"
	"OnTrigger" "musica_normal_2,PlaySound,,172,-1"
	"OnTrigger" "musica_normal_3,PlaySound,,327,-1"
	"OnTrigger" "trigger_normal_dificil_enable,Enable,,0,-1"
	"OnTrigger" "normal_hard_kill1,Kill,,0,-1"
	"OnTrigger" "musica_normal_1,PlaySound,,8,-1"
	"OnTrigger" "luz_fuego_enable,TurnOff,,0,-1"
}
add:
{
	"classname" "logic_relay"
	"targetname" "Stage_Hard_Relay"
	"spawnflags" "0"
	"OnTrigger" "finalnormal,Disable,,0,-1"
	"OnTrigger" "nhbarrica1,Kill,,0,-1"
	"OnTrigger" "hebarricada1,Kill,,0,-1"
	"OnTrigger" "hardbarricada2,Kill,,0,-1"
	"OnTrigger" "extremebarricada2,Kill,,0,-1"
	"OnTrigger" "hebarricada2,Kill,,0,-1"
	"OnTrigger" "hardbarricada4,Break,,0,-1"
	"OnTrigger" "hardbarricada5,Kill,,0,-1"
	"OnTrigger" "normalbarricada1,Kill,,0,-1"
	"OnTrigger" "normalbarricada1,Kill,,0,-1"
	"OnTrigger" "d12,Lock,,0,-1"
	"OnTrigger" "door_final2,Lock,,0,-1"
	"OnTrigger" "duto,Kill,,0,-1"
	"OnTrigger" "commander,Command,say ** LEVEL: HARD **,2,-1"
	"OnTrigger" "boton2,Lock,,0,-1"
	"OnTrigger" "doorend1,Break,,0,-1"
	"OnTrigger" "normalbotonascensores,Kill,,0,-1"
	"OnTrigger" "finaldificil,Enable,,0,-1"
	"OnTrigger" "hardbarricada6,Kill,,0,-1"
	"OnTrigger" "hardextremebarricada1,Kill,,0,-1"
	"OnTrigger" "sprite2,Kill,,0,-1"
	"OnTrigger" "relay_ascensor_extremo,Kill,,0,-1"
	"OnTrigger" "relay_ascensor_normal,Kill,,0,-1"
	"OnTrigger" "killextremo,Kill,,0,-1"
	"OnTrigger" "killnormal,Kill,,0,-1"
	"OnTrigger" "hydra_random_relay,Trigger,,0,-1"
	"OnTrigger" "ganarfacil,Kill,,0,-1"
	"OnTrigger" "tormenta,Enable,,0,-1"
	"OnTrigger" "hard1,Kill,,0,-1"
	"OnTrigger" "hard2,Enable,,0,-1"
	"OnTrigger" "math_puerta_dificil,Enable,,0,-1"
	"OnTrigger" "shake_general,StopShake,,0.5,-1"
	"OnTrigger" "torreta_random,PickRandomShuffle,,0,1"
	"OnTrigger" "lanza_luz,TurnOff,,0,-1"
	"OnTrigger" "hardextremebarrica1,Kill,,0,-1"
	"OnTrigger" "facilboton2,Kill,,0,-1"
	"OnTrigger" "dificilextremo1,Enable,,0,-1"
	"OnTrigger" "musica_dificil_1,PlaySound,,0,-1"
	"OnTrigger" "musica_dificil_2,PlaySound,,105,-1"
	"OnTrigger" "musica_dificil_3,PlaySound,,237,-1"
	"OnTrigger" "musica_dificil_4,PlaySound,,338,-1"
	"OnTrigger" "hydra_random,PickRandomShuffle,,0,-1"
	"OnTrigger" "musica_normal_1,Kill,,0,-1"
	"OnTrigger" "trigger_normal_dificil_enable,Enable,,0,-1"
	"OnTrigger" "normal_hard_kill1,Kill,,0,-1"
	"OnTrigger" "enable_hard1,Enable,,0,-1"
}
add:
{
	"classname" "logic_relay"
	"targetname" "Stage_Extreme_Relay"
	"spawnflags" "0"
	"OnTrigger" "extremebarrica1,Kill,,0,-1"
	"OnTrigger" "nhbarrica2,Kill,,0,-1"
	"OnTrigger" "hebarricada2,Kill,,0,-1"
	"OnTrigger" "door_final,Lock,,0,-1"
	"OnTrigger" "d12,Lock,,0,-1"
	"OnTrigger" "hebarricada1,Kill,,0,-1"
	"OnTrigger" "commander,Command,say ** LEVEL: EXTREME **,2,-1"
	"OnTrigger" "boton1,Lock,,0,-1"
	"OnTrigger" "ebarricada4,Kill,,0,-1"
	"OnTrigger" "Triggermusica3,Enable,,0,-1"
	"OnTrigger" "hardextremebarricada1,Kill,,0,-1"
	"OnTrigger" "sprite1,Kill,,0,-1"
	"OnTrigger" "relay_ascensor_normal,Kill,,0,-1"
	"OnTrigger" "relay_ascensor_hard,Kill,,0,-1"
	"OnTrigger" "killhard,Kill,,0,-1"
	"OnTrigger" "killnormal,Kill,,0,-1"
	"OnTrigger" "extremebarrica3,Kill,,0,-1"
	"OnTrigger" "normalbarricada4,Kill,,0,-1"
	"OnTrigger" "normalbarricada3,Kill,,0,-1"
	"OnTrigger" "brush_sky1,Disable,,0,-1"
	"OnTrigger" "tormenta_particula,Kill,,0,-1"
	"OnTrigger" "extremo1,Enable,,0,-1"
	"OnTrigger" "boton_hard1,Kill,,0,-1"
	"OnTrigger" "shake_general,StopShake,,0.5,-1"
	"OnTrigger" "hard3,Kill,,0,-1"
	"OnTrigger" "tele_facil_hard2_trig,Kill,,0,-1"
	"OnTrigger" "torreta_random,PickRandomShuffle,,0,1"
	"OnTrigger" "lanza_luz,TurnOff,,0,-1"
	"OnTrigger" "hardextremebarrica1,Kill,,0,-1"
	"OnTrigger" "facilboton2,Kill,,0,-1"
	"OnTrigger" "dificilextremo1,Enable,,0,-1"
	"OnTrigger" "trigger_extremo_coches,Enable,,0,-1"
	"OnTrigger" "musica_extremo_1,PlaySound,,5,-1"
	"OnTrigger" "musica_extremo_2,PlaySound,,160,-1"
	"OnTrigger" "musica_normal_1,Kill,,0,-1"
	"OnTrigger" "trigger_extremo_enable,Enable,,0,-1"
	"OnTrigger" "extremo_kill1,Kill,,0,-1"
}

; Clean up old level system
filter:
{
	"classname" "prop_physics_multiplayer"
	"model" "models/props_c17/oildrum001.mdl"
}
filter:
{
	"classname" "trigger_multiple"
	"targetname" "/(facil|normal|dificil)triggeractivador/"
}
filter:
{
	"classname" "trigger_multiple"
	"origin" "/(5060.73|5170.93) 899 -4657/"
}
filter:
{
	"classname" "func_brush"
	"targetname" "/normal|dificil|extremo.*/"
}