;-------------------------------------------------
; Stripper config for ze_night_cinema_css_final
; Version: 02/17/2026
;
; Note: If additional stripper changes were made, custom to a server,
; make sure to audit and include those
;-------------------------------------------------

;-------------------------------------------------
; Additions: 02/17/2026
;-------------------------------------------------

;-------------------------------------------------
; (Fix) The state of these brushes was not being reset at round start
;-------------------------------------------------
modify:
{
	match:
	{
		"classname" "trigger_multiple"
		"targetname" "RM_start_game"
	}
	insert:
	{
		"OnStartTouch" "RM_concert_platform2,Disable,,0,1"
		"OnStartTouch" "RM_concert_platform3,Disable,,0,1"
	}
}
modify:
{
	match:
	{
		"classname" "trigger_once"
		"targetname" "FC_start_game"
	}
	insert:
	{
		"OnStartTouch" "FC_pit_exit,Enable,,0,1"
	}
}

;-------------------------------------------------
; Willy Stage: Slightly increase the cooldown of the Zombie net item: 5s -> 7s
;-------------------------------------------------
modify:
{
	match:
	{
		"classname" "trigger_teleport"
		"targetname" "item_net_teleport"
	}
	delete:
	{
		"OnStartTouchAll" "!selfEnable5-1"
		"OnStartTouchAll" "item_net_cxShowSprite5-1"
	}
	insert:
	{
		"OnStartTouchAll" "!self,Enable,,7,-1"
		"OnStartTouchAll" "item_net_cx,ShowSprite,,7,-1"
	}
}

;-------------------------------------------------
; Chapter 0: Kill the ghost after 115s, if alive (it doesn't scale down on deaths)
;-------------------------------------------------
modify:
{
	match:
	{
		"classname" "logic_relay"
		"targetname" "TR_ghost_onspawn"
	}
	insert:
	{
		"OnSpawn" "TR_ghost_hbx,Break,,115,1"
		"OnSpawn" "TR_ghost_hbx_hp,Kill,,115,1"
	}
}

;-------------------------------------------------
; Retain the robbie box item for all chapter stages as well (to reduce the difficulty)
; Important: Remove the targetname "CW_trigger" edit from the 02/10/2026 stripper version
;-------------------------------------------------
modify:
{
	match:
	{
		"classname" "logic_case"
		"targetname" "chapter_case"
	}
	insert:
	{
		"OnCase03" "item_robbie_EntMaker,ForceSpawn,,4,1"
	}
}

;-------------------------------------------------
; Catacombs Stage: Add boxes in the cinema area to make the hold doable with 1:1 ratio
;-------------------------------------------------
add:
{
	"classname" "prop_dynamic"
	"targetname" "FC_zmod_cinema_box1"
	"origin" "13336 2648 -4656"
	"angles" "0 315 0"
	"model" "models/props/de_nuke/crate_extrasmall.mdl"
	"disablereceiveshadows" "1"
	"disableshadows" "1"
	"solid" "6"
}
add:
{
	"classname" "prop_dynamic"
	"targetname" "FC_zmod_cinema_box2"
	"origin" "13336 2648 -4608"
	"angles" "0 315 0"
	"model" "models/props/de_nuke/crate_extrasmall.mdl"
	"disablereceiveshadows" "1"
	"disableshadows" "1"
	"solid" "6"
}
add:
{
	"classname" "prop_dynamic"
	"targetname" "FC_zmod_cinema_box3"
	"origin" "13028 1960 -4480"
	"angles" "0 330 0"
	"model" "models/props/de_nuke/crate_extrasmall.mdl"
	"disablereceiveshadows" "1"
	"disableshadows" "1"
	"solid" "6"
}

;-------------------------------------------------
; Additions: 02/10/2026
;
; Note to myself: If map is ever re-compiled, dim the lighting in the
; catacombs zombie survival area (which is too bright in the css_final version)
;-------------------------------------------------

;-------------------------------------------------
; Chapter 3: Final arena - Lower green orbs hurt 60 -> 32
;-------------------------------------------------
modify:
{
	match:
	{
		"classname" "trigger_hurt"
		"targetname" "ST_arena_orb_hurt"
	}
	replace:
	{
		"damage" "32"
	}
}

;-------------------------------------------------
; Chapter 3: Final arena - Delay flayer's release ZM attack
;-------------------------------------------------
modify:
{
	match:
	{
		"classname" "logic_relay"
		"targetname" "ST_arena_flayer_onspawn"
	}
	delete:
	{
		"OnSpawn" "ST_arena_relay2Trigger331"
	}
	insert:
	{
		"OnSpawn" "ST_arena_relay2,Trigger,,45,1"
	}
}

;-------------------------------------------------
; Chapter 3: Final arena - Lower final boss HP: 70 -> 65
;-------------------------------------------------
modify:
{
	match:
	{
		"classname" "trigger_multiple"
		"targetname" "ST_arena_vecna_gamezone"
	}
	insert:
	{
		"OnStartTouch" "ST_arena_vecna_hbx_hp,Subtract,5,0.1,-1"
	}
}

;-------------------------------------------------
; Chapter 3: Final arena - Adjust the height of humans lifted in the air: 168 -> 172
; Default: 168 units (max 240-64 = 176). Zombies should just about reach that
; Distance between ground and clipping: 240 units (not accounting for player hitbox)
; In CS:Source the player hitbox is 63 units tall
;-------------------------------------------------
modify:
{
	match:
	{
		"classname" "func_movelinear"
		"targetname" "ST_arena_liftup"
	}
	replace:
	{
		"movedistance" "172"
	}
}

;-------------------------------------------------
; Chapter 3: Final arena - Block AOE damage when robbie box is used
; Alternative way to counter the final boss in case heal was already used or lost
;-------------------------------------------------
modify:
{
	match:
	{
		"classname" "filter_activator_name"
		"targetname" "item_filter_robbie"
	}
	insert:
	{
		"OnPass" "ST_arena_vecna_hurt,SetDamage,0,0,-1"
		"OnPass" "ST_arena_vecna_hurt,SetDamage,8,13,-1"
	}
}
modify:
{
	match:
	{
		"classname" "logic_relay"
		"targetname" "ST_arena_vecna_onspawn"
	}
	insert:
	{
		"OnSpawn" "servercommand,Command,say Robbie can shield humans from taking damage,2,1"
	}
}

;-------------------------------------------------
; Lock the skip movies button until 2 of the regular stages have been cleared
; To access this button, you still need to obtain one of the 4 hidden objects
; Revert the button to being hidden when pressed
;-------------------------------------------------
modify:
{
	match:
	{
		"classname" "func_button"
		"targetname" "cinema_skipToChapters_btn"
	}
	replace:
	{
		"spawnflags" "3073"
	}
}
modify:
{
	match:
	{
		"classname" "logic_compare"
		"targetname" "movies_compare2"
	}
	insert:
	{
		"OnGreaterThan" "cinema_skipToChapters_btn,Unlock,,0,1"
		"OnGreaterThan" "servercommand,Command,say You can now skip the remaining movies,6,1"
		"OnGreaterThan" "servercommand,Command,say Completing all movies grants extra health,8,1"
	}
}
modify:
{
	match:
	{
		"classname" "func_button"
		"targetname" "cinema_skipToChapters_btn"
	}
	insert:
	{
		"OnPressed" "cinema_skipToChapters_block,Enable,,0,1"
	}
}

;-------------------------------------------------
; Retain the robbie box item for all movie stages, even after chapter I is cleared
; (corrected 02/17/2026)
;-------------------------------------------------
modify:
{
	match:
	{
		"classname" "logic_compare"
		"targetname" "movies_compare2"
	}
	delete:
	{
		"OnGreaterThan" "item_robbie_EntMakerKill01"
	}
}

;-------------------------------------------------
; Catacombs Stage: Remove the buttons to disable a human item
; The stage is difficult enough even without these
;-------------------------------------------------
filter:
{
	"targetname" "FC_disable_robbie_btn"
}
filter:
{
	"targetname" "FC_disable_popcorn_btn"
}

;-------------------------------------------------
; Catacombs Stage: Add temporary push to delay Zombies before the drop
; at the water area, to give humans some time to do the crouch part
;-------------------------------------------------
add:
{
	"model" "*418"
	"origin" "10848 -168 -7816"
	"classname" "trigger_push"
	"targetname" "FC_connector_drop_pushT"
	"speed" "500"
	"pushdir" "0 270 0"
	"filtername" "filter_activator_T"
	"spawnflags" "1"
	"OnStartTouch" "!self,Disable,,3,1"
}

;-------------------------------------------------
; Reward for completing all movies (not skipped) - Set humans to 180HP for the last chapters
;-------------------------------------------------
add:
{
	"classname" "info_target"
	"targetname" "movies_reward"
	"OnUser1" "teleport_to_start_CT,AddOutput,OnStartTouch !activator:AddOutput:health 180:0:-1,0,-1"
}
modify:
{
	match:
	{
		"classname" "func_button"
		"targetname" "cinema_skipToChapters_btn"
	}
	insert:
	{
		"OnPressed" "movies_reward,Kill,,0,1"
	}
}
modify:
{
	match:
	{
		"classname" "logic_case"
		"targetname" "chapter_case"
	}
	insert:
	{
		"OnCase03" "movies_reward,FireUser1,,0,1"
		"OnCase04" "movies_reward,FireUser1,,0,1"
	}
}

;-------------------------------------------------
; Warmup: Don't replay the warmup if 30s have passed (and round restarted)
;-------------------------------------------------
modify:
{
	match:
	{
		"classname" "logic_relay"
		"targetname" "warmup_end_relay"
	}
	insert:
	{
		"OnTrigger" "warmup_end,Trigger,,5,1"
	}
}

;-------------------------------------------------
; Additions: 01/25/2026 (corrected 02/10/2026)
;-------------------------------------------------

;-------------------------------------------------
; Chapter 0: Lower ghost HP 250x -> 200x
;-------------------------------------------------
modify:
{
	match:
	{
		"classname" "trigger_multiple"
		"targetname" "TR_ghost_gamezone"
	}
	insert:
	{
		"OnStartTouch" "TR_ghost_hbx_hp,Subtract,50,0.1,-1"
	}
}

;-------------------------------------------------
; Chapter 0: Lower ghost hurt 80 -> 60
;-------------------------------------------------
modify:
{
	match:
	{
		"classname" "trigger_hurt"
		"targetname" "TR_ghost_hurt"
	}
	replace:
	{
		"damage" "60"
	}
}

;-------------------------------------------------
; Chapter 0: Delay re-enabling hurt after ghost re-appears
;-------------------------------------------------
modify:
{
	match:
	{
		"classname" "logic_case"
		"targetname" "TR_ghost_case"
	}
	delete:
	{
		"OnCase01" "TR_ghost_hurtEnable16-1"
		"OnCase02" "TR_ghost_hurtEnable16-1"
	}
	insert:
	{
		"OnCase01" "TR_ghost_hurt,Enable,,18,-1"
		"OnCase02" "TR_ghost_hurt,Enable,,18,-1"
	}
}

;-------------------------------------------------
; Chapter 0: Increase final area push: 400 -> 650
;-------------------------------------------------
modify:
{
	match:
	{
		"classname" "trigger_push"
		"targetname" "TR_wormhole_pushCT"
	}
	replace:
	{
		"speed" "650"
	}
}

;-------------------------------------------------
; Willy Stage: At the end of the ostrich mini-game, a hurt trigger is
; activated to kill the zombie net item users in the arena. However, the
; trigger did not apply damage on the Unloze server.
; 
; Change the trigger to self-disable and un-suppress zombie attack after
; OnHurtPlayer event instead, to ensure that damage has been applied, as
; damage interval of 0.5s is not guaranteed and can be server adjusted
;-------------------------------------------------
modify:
{
	match:
	{
		"classname" "trigger_hurt"
		"targetname" "item_net_kill"
	}
	delete:
	{
		"OnStartTouch" "!selfDisable1-1"
		"OnStartTouch" "suppress_attackModifySpeed1.000000011-1"
	}
	insert:
	{
		"OnHurtPlayer" "!self,Disable,,1,-1"
		"OnHurtPlayer" "suppress_attack,ModifySpeed,1.00000001,1,-1"
	}
}
; Also delay un-supressing the attack through the other logic paths
modify:
{
	match:
	{
		"classname" "weapon_knife"
		"targetname" "item_net_knife"
	}
	delete:
	{
		"OnPlayerPickup" "suppress_attackModifySpeed1.0000000146-1"
	}
	insert:
	{
		"OnPlayerPickup" "suppress_attack,ModifySpeed,1.00000001,50,-1"
	}
}
