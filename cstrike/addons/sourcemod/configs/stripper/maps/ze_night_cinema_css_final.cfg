;-------------------------------------------------
; Stripper config for ze_night_cinema_css_final
; Version: 02/10/2026
;-------------------------------------------------

;-------------------------------------------------
; Additions: 02/10/2026
;-------------------------------------------------

;-------------------------------------------------
; Chapter 3: Final arena - Lower green orbs hurt 60 -> 24
;-------------------------------------------------
modify:
{
	match:
	{
		"classname" "trigger_hurt"
		"targetname" "ST_arena_orb_hurt"
	}
	replace:
	{
		"damage" "24"
	}
}

;-------------------------------------------------
; Chapter 3: Final arena - Delay flayer release ZM attack
;-------------------------------------------------
modify:
{
	match:
	{
		"classname" "logic_relay"
		"targetname" "ST_arena_flayer_onspawn"
	}
	delete:
	{
		"OnSpawn" "ST_arena_relay2,Trigger,,33,1"
	}
	insert:
	{
		"OnSpawn" "ST_arena_relay2,Trigger,,45,1"
	}
}

;-------------------------------------------------
; Chapter 3: Final arena - Lower final boss HP: 70 -> 60
;-------------------------------------------------
modify:
{
	match:
	{
		"classname" "trigger_multiple"
		"targetname" "ST_arena_vecna_gamezone"
	}
	insert:
	{
		"OnStartTouch" "ST_arena_vecna_hbx_hp,Subtract,10,0.1,-1"
	}
}

;-------------------------------------------------
; Chapter 3: Final arena - Block AOE damage when robbie box is used
; This is alternative option to counter the final boss AOE damage
; in case the heal item was already used or lost
;-------------------------------------------------
modify:
{
	match:
	{
		"classname" "filter_activator_name"
		"targetname" "item_filter_robbie"
	}
	insert:
	{
		"OnPass" "ST_arena_vecna_hurt,SetDamage,0,0,-1"
		"OnPass" "ST_arena_vecna_hurt,SetDamage,8,13,-1"
	}
}
modify:
{
	match:
	{
		"classname" "logic_relay"
		"targetname" "ST_arena_vecna_onspawn"
	}
	insert:
	{
		"OnSpawn" "servercommand,Command,say Robbie can block the AOE attack,2,1"
	}
}

;-------------------------------------------------
; Lock the skip levels button until 2 of the regular stages have been cleared
; To access this button, you still need to obtain one of the 4 hidden objects
; Update the button so when pressed it reverts to being hidden
;-------------------------------------------------
modify:
{
	match:
	{
		"classname" "func_button"
		"targetname" "cinema_skipToChapters_btn"
	}
	replace:
	{
		"spawnflags" "2048"
	}
}
modify:
{
	match:
	{
		"classname" "logic_compare"
		"targetname" "movies_compare2"
	}
	insert:
	{
		"OnGreaterThan" "cinema_skipToChapters_btn,Unlock,,0,1"
		"OnGreaterThan" "servercommand,Command,say You can now skip the remaining movies,6,1"
	}
}
modify:
{
	match:
	{
		"classname" "func_button"
		"targetname" "cinema_skipToChapters_btn"
	}
	insert:
	{
		"OnPressed" "cinema_skipToChapters_block,Enable,,0,1"
	}
}

;-------------------------------------------------
; Retain the robbie box item even after stage 3 has been cleared
;-------------------------------------------------
modify:
{
	match:
	{
		"classname" "logic_compare"
		"targetname" "movies_compare2"
	}
	delete:
	{
		"OnGreaterThan" "item_robbie_EntMaker,Kill,,0,1"
	}
}

;-------------------------------------------------
; Catacombs Stage: Remove the buttons to disable a human item
; The stage is difficult enough even without these
;-------------------------------------------------
filter:
{
	"targetname" "FC_disable_robbie_btn"
}
filter:
{
	"targetname" "FC_disable_popcorn_btn"
}

;-------------------------------------------------
; Catacombs Stage: Add temporary push to delay Zombies before the drop
; at the water area, to give humans some time to do the crouch part
;-------------------------------------------------
add:
{
	"model" "*418"
	"origin" "10848 -168 -7816"
	"classname" "trigger_push"
	"targetname" "FC_connector_drop_pushT"
	"speed" "500"
	"pushdir" "0 270 0"
	"filtername" "filter_activator_T"
	"spawnflags" "1"
	"OnStartTouch" "!self,Disable,,3,1"
}

;-------------------------------------------------
; Add reward for completing all non-chapter stages (if none skipped)
; Set human health to 180HP, an advantage for the last 2 chapters
;-------------------------------------------------
add:
{
	"classname" "info_target"
	"targetname" "movies_reward"
	"OnUser1" "teleport_to_start_CT,AddOutput,OnStartTouch !activator:AddOutput:health 180:0:-1,0,-1"
}
modify:
{
	match:
	{
		"classname" "func_button"
		"targetname" "cinema_skipToChapters_btn"
	}
	insert:
	{
		"OnPressed" "movies_reward,Kill,,0,1"
	}
}
modify:
{
	match:
	{
		"classname" "logic_case"
		"targetname" "chapter_case"
	}
	insert:
	{
		"OnCase03" "movies_reward,FireUser1,,0,1"
		"OnCase04" "movies_reward,FireUser1,,0,1"
	}
}

;-------------------------------------------------
; Additions: 01/25/2026
;-------------------------------------------------

;-------------------------------------------------
; Chapter 0: Lower ghost HP 250x -> 200x
;-------------------------------------------------
modify:
{
	match:
	{
		"classname" "trigger_multiple"
		"targetname" "TR_ghost_gamezone"
	}
	insert:
	{
		"OnStartTouch" "TR_ghost_hbx_hp,Subtract,50,0.1,-1"
	}
}

;-------------------------------------------------
; Chapter 0: Lower ghost hurt 80 -> 60
;-------------------------------------------------
modify:
{
	match:
	{
		"classname" "trigger_hurt"
		"targetname" "TR_ghost_hurt"
	}
	replace:
	{
		"damage" "60"
	}
}

;-------------------------------------------------
; Chapter 0: Delay re-enabling hurt after ghost re-appears
;-------------------------------------------------
modify:
{
	match:
	{
		"classname" "logic_case"
		"targetname" "TR_ghost_case"
	}
	delete:
	{
		"OnCase01" "TR_ghost_hurt,Enable,,16,-1"
		"OnCase02" "TR_ghost_hurt,Enable,,16,-1"
	}
	insert:
	{
		"OnCase01" "TR_ghost_hurt,Enable,,19,-1"
		"OnCase02" "TR_ghost_hurt,Enable,,19,-1"
	}
}

;-------------------------------------------------
; Chapter 0: Increase final area push: 400 -> 650
;-------------------------------------------------
modify:
{
	match:
	{
		"classname" "trigger_push"
		"targetname" "TR_wormhole_pushCT"
	}
	replace:
	{
		"speed" "650"
	}
}

;-------------------------------------------------
; Willy Stage: At the end of the ostrich mini-game, a hurt trigger is
; activated to kill the zombie net item users in the arena. However, the
; trigger did not apply damage on the Unloze server.
; 
; Change the trigger to self-disable and un-suppress zombie attack after
; OnHurtPlayer event instead, to ensure that damage has been applied, as
; damage interval of 0.5s is not guaranteed and can be server adjusted
;-------------------------------------------------
modify:
{
	match:
	{
		"classname" "trigger_hurt"
		"targetname" "item_net_kill"
	}
	delete:
	{
		"OnStartTouch" "!self,Disable,,1,-1"
		"OnStartTouch" "suppress_attack,ModifySpeed,1.00000001,1,-1"
	}
	insert:
	{
		"OnHurtPlayer" "!self,Disable,,1,-1"
		"OnHurtPlayer" "suppress_attack,ModifySpeed,1.00000001,1,-1"
	}
}
; Also delay un-supressing the attack through the other logic paths
modify:
{
	match:
	{
		"classname" "weapon_knife"
		"targetname" "item_net_knife"
	}
	delete:
	{
		"OnPlayerPickup" "suppress_attack,ModifySpeed,1.00000001,46,-1"
	}
	insert:
	{
		"OnPlayerPickup" "suppress_attack,ModifySpeed,1.00000001,50,-1"
	}
}
